[build]
command = "next build"
publish = "out" # Next.js 的标准输出路径

# 1. 路径重写 (相当于 Vercel 的 Rewrites)
# 解决 /pdfjs-annotation-viewer/ 访问 404 的问题
[[redirects]]
from = "/pdfjs-annotation-viewer/web/viewer"
to = "/web/viewer.html"
status = 200

[[redirects]]
from = "/pdfjs-annotation-viewer/*"
to = "/:splat"
status = 200

# 2. 全局安全请求头
[[headers]]
for = "/*"
[headers.values]
X-Content-Type-Options = "nosniff"
X-Frame-Options = "SAMEORIGIN"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"

# 3. 静态资源长时间缓存 (JS/CSS)
[[headers]]
for = "/*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# 4. 图片及媒体文件缓存
[[headers]]
for = "/*.(png|jpg|jpeg|gif|svg|webp|avif|ico)"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# 5. 字体文件缓存
[[headers]]
for = "/*.(woff|woff2|ttf|eot)"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# 6. WASM 特殊处理
[[headers]]
for = "/*.wasm"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"
Content-Type = "application/wasm"

# 7. 针对特定路径的缓存规则
[[headers]]
for = "/workers/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/pdfjs-annotation-viewer/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"